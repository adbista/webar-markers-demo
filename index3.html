<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>

    <style>
      #infoPanel {
        position: fixed;
        left: 12px; right: 12px; bottom: 12px;
        z-index: 9999;
        display: none;
        padding: 16px;
        border-radius: 16px;
        background: rgba(15, 15, 15, 0.9);
        backdrop-filter: blur(10px);
        color: #fff;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        line-height: 1.4;
        box-shadow: 0 12px 40px rgba(0,0,0,0.5);
        border: 1px solid rgba(255,255,255,0.1);
      }
      #infoPanel .title { font-weight: 700; margin-bottom: 8px; font-size: 18px; letter-spacing: -0.02em; }
      #infoClose {
        position: absolute; top: 12px; right: 12px;
        background: rgba(255,255,255,0.1); border: 0; color: #fff;
        width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
        display: flex; align-items: center; justify-content: center;
      }
      #infoBody p { margin: 10px 0; font-size: 14px; color: #ccc; }
      #infoBody ul { margin: 10px 0 0 18px; padding: 0; font-size: 14px; color: #ccc; }
      #infoBody li { margin: 8px 0; }
      #infoBody a { color: #007AFF; text-decoration: none; font-weight: 500; }
      .ctaRow { display: flex; gap: 8px; margin-top: 16px; flex-wrap: wrap; }
      .btn {
        display: inline-block; padding: 10px 20px; border-radius: 8px;
        background: #fff; color: #000; text-decoration: none;
        font-weight: 600; font-size: 13px; transition: opacity 0.2s;
      }
      .btn:hover { opacity: 0.9; }
      .tag {
        display:inline-block; font-size: 10px; padding: 2px 8px; border-radius: 4px;
        background: rgba(255,255,255,0.15); vertical-align: middle; margin-left: 8px;
        text-transform: uppercase; font-weight: bold;
      }
    </style>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div id="infoPanel" role="dialog">
      <button id="infoClose" aria-label="Zamknij">✕</button>
      <div class="title" id="infoTitle"></div>
      <div id="infoBody"></div>
    </div>

    <a-scene
      vr-mode-ui="enabled: false;"
      loading-screen="enabled: false;"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
      embedded
      gesture-detector
    >
      <!-- NIKE -->
      <a-marker
        id="marker-main"
        type="pattern"
        preset="custom"
        url="assets/marker.patt"
        emitevents="true"
      >
        <a-image
          id="img-main"
          src="assets/asset.png"
          scale="1 1 1"
          rotation="-90 0 0"
          gesture-handler
        ></a-image>
      </a-marker>

      <!-- APPLE -->
      <a-marker
        id="marker-apple"
        type="pattern"
        preset="custom"
        url="assets/markerApple.patt"
        emitevents="true"
      >
        <a-image
          id="img-apple"
          src="assets/assetApple.jpeg"
          scale="1 1 1"
          rotation="-90 0 0"
          gesture-handler
        ></a-image>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const panel = document.getElementById("infoPanel");
        const titleEl = document.getElementById("infoTitle");
        const bodyEl = document.getElementById("infoBody");
        const closeBtn = document.getElementById("infoClose");

        const markerNike = document.getElementById("marker-main");
        const markerApple = document.getElementById("marker-apple");

        let visibleMarkerId = null;

        function showInfo(title, bodyHtml) {
          titleEl.innerHTML = title;
          bodyEl.innerHTML = bodyHtml;
          panel.style.display = "block";
        }

        function hideInfo() {
          panel.style.display = "none";
        }

        closeBtn.addEventListener("click", () => {
          // ręczne zamknięcie panelu; marker dalej może być widoczny
          visibleMarkerId = null;
          hideInfo();
        });

        const content = {
          nike: {
            title: "Nike <span class='tag'>Wykryto</span>",
            html: `
              <p>Wykryto marker marki <b>Nike</b>. Sportowy styl i technologie dla lepszej wydajności.</p>
              <ul>
                <li>Buty i odzież do treningu i na co dzień</li>
                <li>Materiały wspierające komfort i oddychalność</li>
                <li>Kolekcje lifestyle i performance</li>
              </ul>
              <div class="ctaRow">
                <a class="btn" href="https://www.nike.com/w/new-shoes" target="_blank" rel="noopener">Nowości</a>
                <a class="btn" href="https://www.nike.com/" target="_blank" rel="noopener">Przejdź do Nike</a>
              </div>
            `
          },
          apple: {
            title: "Apple <span class='tag'>Wykryto</span>",
            html: `
              <p>Rozpoznano marker <b>Apple</b>. Ekosystem urządzeń i usług, które działają razem.</p>
              <ul>
                <li>Apple Silicon: wysoka wydajność i energooszczędność</li>
                <li>Spójne doświadczenie: iPhone, Mac, iPad</li>
                <li>Nacisk na prywatność i bezpieczeństwo</li>
              </ul>
              <div class="ctaRow">
                <a class="btn" href="https://www.apple.com/iphone/" target="_blank" rel="noopener">iPhone</a>
                <a class="btn" href="https://www.apple.com/mac/" target="_blank" rel="noopener">Mac</a>
              </div>
            `
          }
        };

        // NIKE marker
        markerNike.addEventListener("markerFound", () => {
          visibleMarkerId = "nike";
          showInfo(content.nike.title, content.nike.html);
        });
        markerNike.addEventListener("markerLost", () => {
          if (visibleMarkerId === "nike") {
            visibleMarkerId = null;
            hideInfo();
          }
        });

        // APPLE marker
        markerApple.addEventListener("markerFound", () => {
          visibleMarkerId = "apple";
          showInfo(content.apple.title, content.apple.html);
        });
        markerApple.addEventListener("markerLost", () => {
          if (visibleMarkerId === "apple") {
            visibleMarkerId = null;
            hideInfo();
          }
        });
      });
    </script>
  </body>
</html>
