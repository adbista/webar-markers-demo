<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.7/aframe/build/aframe-ar.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-detector.js"></script>
    <script src="https://raw.githack.com/AR-js-org/studio-backend/master/src/modules/marker/tools/gesture-handler.js"></script>




<style>
      /* --- FIX DLA CZARNEGO EKRANU --- */
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        /* Ważne: tło musi być przezroczyste, by widać było wideo pod spodem */
        background-color: transparent;
      }

      /* AR.js automatycznie dodaje element video do body. 
         Poniższy styl pilnuje, by nie był przesunięty. */
      #arjs-video {
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        z-index: -1; /* Wideo zawsze pod spodem */
      }

      /* --- UI PANEL --- */
      :root {
        --bg-panel: rgba(25, 25, 25, 0.9);
        --accent: #007aff;
      }

      #infoPanel {
        position: fixed;
        z-index: 9999;
        display: none;
        background: var(--bg-panel);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        color: white;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        font-family: sans-serif;
        box-shadow: 0 8px 32px rgba(0,0,0,0.5);
      }

      /* Resposywność panelu */
      @media (min-width: 768px) {
        #infoPanel { left: 20px; bottom: 20px; width: 380px; border-radius: 16px; }
      }
      @media (max-width: 767px) {
        #infoPanel { left: 10px; right: 10px; bottom: calc(10px + env(safe-area-inset-bottom)); border-radius: 20px; }
      }

      .title { font-weight: bold; font-size: 1.2rem; margin-bottom: 10px; display: flex; justify-content: space-between; }
      #infoClose { cursor: pointer; background: none; border: none; color: white; font-size: 20px; }
      .ctaRow { display: flex; gap: 10px; margin-top: 15px; }
      .btn { flex: 1; padding: 10px; text-align: center; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 13px; }
      .btn-primary { background: white; color: black; }
      .btn-sec { background: rgba(255,255,255,0.1); color: white; }
    </style>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div id="infoPanel" role="dialog">
      <button id="infoClose" aria-label="Zamknij">✕</button>
      <div class="title" id="infoTitle"></div>
      <div id="infoBody"></div>
    </div>

    <a-scene
      vr-mode-ui="enabled: false;"
      loading-screen="enabled: false;"
      arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;"
      embedded
      gesture-detector
    >
      <!-- NIKE -->
      <a-marker
        id="marker-main"
        type="pattern"
        preset="custom"
        url="assets/marker.patt"
        emitevents="true"
      >
        <a-image
          id="img-main"
          src="assets/asset.png"
          scale="1 1 1"
          rotation="-90 0 0"
          gesture-handler
        ></a-image>
      </a-marker>

      <!-- APPLE -->
      <a-marker
        id="marker-apple"
        type="pattern"
        preset="custom"
        url="assets/markerApple.patt"
        emitevents="true"
      >
        <a-image
          id="img-apple"
          src="assets/assetApple.jpeg"
          scale="1 1 1"
          rotation="-90 0 0"
          gesture-handler
        ></a-image>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>

    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const panel = document.getElementById("infoPanel");
        const titleEl = document.getElementById("infoTitle");
        const bodyEl = document.getElementById("infoBody");
        const closeBtn = document.getElementById("infoClose");

        const markerNike = document.getElementById("marker-main");
        const markerApple = document.getElementById("marker-apple");

        let visibleMarkerId = null;

        function showInfo(title, bodyHtml) {
          titleEl.innerHTML = title;
          bodyEl.innerHTML = bodyHtml;
          panel.style.display = "block";
        }

        function hideInfo() {
          panel.style.display = "none";
        }

        closeBtn.addEventListener("click", () => {
          // ręczne zamknięcie panelu; marker dalej może być widoczny
          visibleMarkerId = null;
          hideInfo();
        });

        const content = {
          nike: {
            title: "Nike <span class='tag'>Wykryto</span>",
            html: `
              <p>Wykryto marker marki <b>Nike</b>. Sportowy styl i technologie dla lepszej wydajności.</p>
              <ul>
                <li>Buty i odzież do treningu i na co dzień</li>
                <li>Materiały wspierające komfort i oddychalność</li>
                <li>Kolekcje lifestyle i performance</li>
              </ul>
              <div class="ctaRow">
                <a class="btn" href="https://www.nike.com/w/new-shoes" target="_blank" rel="noopener">Nowości</a>
                <a class="btn" href="https://www.nike.com/" target="_blank" rel="noopener">Przejdź do Nike</a>
              </div>
            `
          },
          apple: {
            title: "Apple <span class='tag'>Wykryto</span>",
            html: `
              <p>Rozpoznano marker <b>Apple</b>. Ekosystem urządzeń i usług, które działają razem.</p>
              <ul>
                <li>Apple Silicon: wysoka wydajność i energooszczędność</li>
                <li>Spójne doświadczenie: iPhone, Mac, iPad</li>
                <li>Nacisk na prywatność i bezpieczeństwo</li>
              </ul>
              <div class="ctaRow">
                <a class="btn" href="https://www.apple.com/iphone/" target="_blank" rel="noopener">iPhone</a>
                <a class="btn" href="https://www.apple.com/mac/" target="_blank" rel="noopener">Mac</a>
              </div>
            `
          }
        };

        // NIKE marker
        markerNike.addEventListener("markerFound", () => {
          visibleMarkerId = "nike";
          showInfo(content.nike.title, content.nike.html);
        });
        markerNike.addEventListener("markerLost", () => {
          if (visibleMarkerId === "nike") {
            visibleMarkerId = null;
            hideInfo();
          }
        });

        // APPLE marker
        markerApple.addEventListener("markerFound", () => {
          visibleMarkerId = "apple";
          showInfo(content.apple.title, content.apple.html);
        });
        markerApple.addEventListener("markerLost", () => {
          if (visibleMarkerId === "apple") {
            visibleMarkerId = null;
            hideInfo();
          }
        });
      });
    </script>
  </body>
</html>
